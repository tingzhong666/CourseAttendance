import{r as s,n as S,j as v}from"./index-BpOub9d4.js";import{S as c,U as a,A as i,s as U}from"./httpInstance-CuzQbMQa.js";const u=s.createContext({}),I=({children:l})=>{const[m,r]=s.useState(null),[d,f]=s.useState(null),[h,g]=s.useState(!1),n=S();s.useEffect(()=>{(async()=>{const e=localStorage.getItem("token");e&&(r(e),c.defaults.headers.common.Authorization="Bearer "+e),await k()&&await p(),g(!0)})()},[]);const p=async()=>{var t=await i.apiAccountProfileSelfGet();if(t.data.code!=1){let o="";switch(t.data.code){case 4:o="获取当前用户ID失败";break;case 5:o="获取当前用户信息失败";break}U.info({message:o,placement:"topRight"});return}let e=t.data.data;f({userName:e==null?void 0:e.userName,roles:e==null?void 0:e.roles,name:e==null?void 0:e.name,id:e==null?void 0:e.id})},k=async()=>(await i.apiAccountCheckGet()).data.code!=1?(n("/login"),!1):!0,x=()=>{localStorage.removeItem("token"),r(null),c.defaults.headers.common.Authorization="",n("/login")},A=t=>{switch(t){case a.Admin:return"管理员";case a.Academic:return"教务处人员";case a.Teacher:return"老师";case a.Student:return"学生";default:return""}};return v.jsx(u.Provider,{value:{token:m,logout:x,user:d,roleMap:A},children:h?l:null})},R=()=>s.useContext(u);export{I as U,R as u};
