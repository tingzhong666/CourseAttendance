import{r as e,j as t}from"./index-DgfN0RmO.js";import{u as J}from"./auth-CecISokB.js";import{e as x,M as Q,U as z}from"./httpInstance-C_FOBErx.js";import{M as W,S as O,F as X,P as Y}from"./Table-SxWRHuAv.js";import{u as U}from"./major-CxZ5Y5SK.js";import{F as v,I as Z,S as ee}from"./index-_43Vwt3Q.js";import{S as te}from"./index-DgSE1BWK.js";import{B as N}from"./button-Ds4jMy4a.js";import"./Compact-dGReMvx5.js";import"./addEventListener-DRIwr8ko.js";import"./row-Dhi0eNVG.js";import"./EllipsisOutlined-BYhQ3a5y.js";import"./Overflow-CC-a_4zy.js";import"./index-B0Z_OXbc.js";import"./index-DPluUIIC.js";import"./useVariants-PvTSNNAD.js";const ae=a=>{const[S,g]=e.useState(!1),[P,w]=e.useState(!1),[M,f]=e.useState(""),b=U();e.useEffect(()=>{g(a.show),a.show&&T()},[a.show]),e.useEffect(()=>{a.showChange(S)},[S]);const T=async()=>{var r,u,m;if(a.model=="put"){var s=await x.apiMajorsSubcategoryIdGet(a.putId||-1);const h=(r=b.majorsCategories.find(j=>{var F;return j.id==((F=s.data.data)==null?void 0:F.majorsCategoriesId)}))==null?void 0:r.name;y([{label:h,value:(u=s.data.data)==null?void 0:u.id}]),l(((m=s.data.data)==null?void 0:m.id)+""),C(h||""),c.setFieldsValue(s.data.data),f("修改专业")}else a.model=="add"?(c.resetFields(),f("新增专业"),I("")):a.model=="get"&&f("专业详情")},A=()=>{g(!1)},R=()=>{c.submit()},[c]=v.useForm(),p=async s=>{try{await c.validateFields(),w(!0),a.model=="add"?await x.apiMajorsSubcategoryPost(s):a.model=="put"&&await x.apiMajorsSubcategoryPut(a.putId,s),a.onFinish(),g(!1)}catch{}w(!1)},[d,y]=e.useState([]),[E,l]=e.useState(""),[V,C]=e.useState(""),I=async s=>{var m,h;C(s);const u=(h=(m=(await Q.apiMajorsCategoryGet(1,9999,s)).data.data)==null?void 0:m.dataList)==null?void 0:h.map(j=>({label:j.name,value:j.id}));y(u||[])},L=s=>{var r;l(s),C(((r=d==null?void 0:d.find(u=>u.value==s))==null?void 0:r.label)+"")};return t.jsx(W,{title:M,open:S,onOk:R,onCancel:A,confirmLoading:P,okText:"确定",cancelText:"取消",children:t.jsxs(v,{layout:"vertical",form:c,onFinish:p,children:[t.jsx(v.Item,{name:"name",rules:[{required:!0,message:"不能为空"}],label:"专业名",children:t.jsx(Z,{placeholder:"专业名"})}),t.jsx(v.Item,{name:"majorsCategoryId",rules:[{required:!0,message:"不能为空"}],label:"大专业",children:t.jsx(te,{showSearch:!0,placeholder:"输入搜索",onSearch:I,options:d,optionFilterProp:"label",value:E,searchValue:V,onChange:L})})]})})},Ce=()=>{var _,q;const a=J(),[S,g]=e.useState([]),[P,w]=e.useState(0),[M,f]=e.useState(1),[b,T]=e.useState(20),[A,R]=e.useState(""),c=U(),[p,d]=e.useState(!1),y=e.useRef(p);e.useEffect(()=>{y.current=p},[p]),e.useEffect(()=>(E(),()=>{y.current&&c.update()}),[]);const E=async()=>{await l()},l=async(o=M,n=b,i=A)=>{var B,D,G;var k=await x.apiMajorsSubcategoryGet(void 0,o,n,i);const $=(D=(B=k.data.data)==null?void 0:B.dataList)==null?void 0:D.map(H=>H);g($||[]),w(((G=k.data.data)==null?void 0:G.total)||0)},V=async o=>{await x.apiMajorsSubcategoryDelete(o.id),await l(),d(!0)},C=[{title:"名称",dataIndex:"name",key:"name"},{title:"父专业",dataIndex:"parentName",key:"parentName",render:(o,n)=>{const i=c.majorsCategories.find(k=>k.id==n.majorsCategoriesId);return(i==null?void 0:i.name)||""}},{title:"操作",key:"action",render:(o,n)=>t.jsxs(O,{size:"middle",children:[t.jsx("a",{onClick:()=>K(n.id||-1),children:"修改"}),t.jsx(Y,{title:"提示",description:`确定删除专业 ${n.name} ?`,onConfirm:()=>V(n),okText:"确定",cancelText:"取消",children:t.jsx(N,{danger:!0,children:"删除"})})]})}],I=async(o,n,i)=>{(i==null?void 0:i.source)=="input"&&await l(1,void 0,o)},L=async(o,n)=>{f(o),T(n),await l(o,n)},[s,r]=e.useState(!1),[u,m]=e.useState(-1),[h,j]=e.useState("add"),F=()=>{j("add"),r(!0),d(!0)},K=o=>{j("put"),r(!0),m(o),d(!0)};return t.jsxs(O,{direction:"vertical",style:{width:"100%"},children:[t.jsxs(O,{children:[t.jsx(ee,{placeholder:"输入查询的专业名",onSearch:I,enterButton:!0}),(_=a.user)!=null&&_.roles.includes(z.Admin)||(q=a.user)!=null&&q.roles.includes(z.Academic)?t.jsx(N,{type:"primary",onClick:F,children:"新增"}):t.jsx(t.Fragment,{})]}),t.jsx(X,{columns:C,pagination:{position:["bottomCenter"],total:P,showSizeChanger:!0,current:M,pageSize:b,onChange:L},dataSource:S,rowKey:"id"}),t.jsx(ae,{show:s,showChange:o=>r(o),onFinish:l,model:h,putId:u})]})};export{Ce as default};
