import{r as s,n as v,j as U}from"./index-ZtOdBFYM.js";import{S as c,A as u,s as w,U as a}from"./httpInstance-BCqN5o7-.js";const i=s.createContext({}),R=({children:l})=>{const[m,r]=s.useState(null),[d,f]=s.useState(null),[h,g]=s.useState(!1),n=v();s.useEffect(()=>{p()},[]);const p=async()=>{const t=localStorage.getItem("token");t&&(r(t),c.defaults.headers.common.Authorization="Bearer "+t),await x()&&(await k(),g(!0))},k=async()=>{var t=await u.apiAccountProfileSelfGet();if(t.data.code!=1){let o="";switch(t.data.code){case 4:o="获取当前用户ID失败";break;case 5:o="获取当前用户信息失败";break}w.info({message:o,placement:"topRight"});return}let e=t.data.data;f({userName:e==null?void 0:e.userName,roles:e==null?void 0:e.roles,name:e==null?void 0:e.name,id:e==null?void 0:e.id})},x=async()=>(await u.apiAccountCheckGet()).data.code!=1?(n("/login"),!1):!0,A=()=>{localStorage.removeItem("token"),r(null),c.defaults.headers.common.Authorization="",n("/login")},S=t=>{switch(t){case a.Admin:return"管理员";case a.Academic:return"教务处人员";case a.Teacher:return"老师";case a.Student:return"学生";default:return""}};return U.jsx(i.Provider,{value:{token:m,logout:A,user:d,roleMap:S},children:h?l:null})},C=()=>s.useContext(i);export{R as U,C as u};
