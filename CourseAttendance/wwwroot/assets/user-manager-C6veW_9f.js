import{r as s,j as e,A as $}from"./index-BpOub9d4.js";import{A as I,U as R}from"./httpInstance-CuzQbMQa.js";import{u as G}from"./auth-D4BlDN8S.js";import{F as l,I as j,S as H}from"./index-B5rnsf0y.js";import{u as J}from"./major-F_TzPVMo.js";import{M as K,S as B,F as X,P as Y}from"./Table-8trnBCGB.js";import{S as z}from"./index-GUdFaacW.js";import{B as W}from"./button-jEW9GZRM.js";import"./Compact-IDRBBHga.js";import"./useVariants-fOaw6h8-.js";import"./row-D3CEMKuo.js";import"./addEventListener-C0Rk0JU6.js";import"./EllipsisOutlined-CKyrYPco.js";import"./Overflow-lUpr0VgG.js";import"./index-D_Thouwj.js";import"./index-DxLp7bV8.js";const Z=t=>{const[i,c]=s.useState(!1),[y,g]=s.useState(!1),[w,m]=s.useState(""),S=G();s.useEffect(()=>{c(t.show),t.show&&b()},[t.show]),s.useEffect(()=>{t.showChange(i)},[i]);const b=async()=>{var d,r,L,k,a,o,f,A,P,E;if(t.model=="put"||t.model=="get"){var n=await I.apiAccountIdGet(t.putId||"");const Q={email:(d=n.data.data)==null?void 0:d.email,phone:(r=n.data.data)==null?void 0:r.phoneNumber,name:((L=n.data.data)==null?void 0:L.name)||"",userName:((k=n.data.data)==null?void 0:k.userName)||"",roles:((a=n.data.data)==null?void 0:a.roles)||[],createAcademicExt:{},createAdminExt:{},createStudentExt:{gradId:((f=(o=n.data.data)==null?void 0:o.getStudentExt)==null?void 0:f.gradeId)||-1},createTeacherExt:{}};h.setFieldsValue(Q),u(""),O(((P=(A=n.data.data)==null?void 0:A.getStudentExt)==null?void 0:P.gradeId)||-1),V(((E=n.data.data)==null?void 0:E.roles)||[])}else t.model=="add"&&(h.resetFields(),h.setFieldValue("roles",[R.Student]),u(""));t.model=="put"?m("修改班级"):t.model=="get"?m("用户详情"):t.model=="add"&&m("新增用户")},C=()=>{c(!1)},M=()=>{h.submit()},[h]=l.useForm(),p=async n=>{try{await h.validateFields(),g(!0),t.model=="add"?await I.apiAccountPost(n):t.model=="put"&&await I.apiAccountUpdateUserPut(t.putId,n),c(!1),t.onFinish()}catch{}g(!1)},U=J(),[x,T]=s.useState([]),[F,O]=s.useState(-1),[q,N]=s.useState(""),u=n=>{N(n);const d=U.classesStr.map(r=>({label:r.name,value:r.id}));T(d||[])},v=n=>{var d;O(n),N(((d=x==null?void 0:x.find(r=>r.value==n))==null?void 0:d.label)+"")},[_,V]=s.useState([]),D=(n,d)=>{V(d.roles)};return e.jsx(K,{title:w,open:i,onOk:M,onCancel:C,confirmLoading:y,children:e.jsxs(l,{layout:"vertical",form:h,onFinish:p,onValuesChange:D,children:[e.jsx(l.Item,{name:"name",label:"姓名",rules:[{required:!0,message:"不能为空"}],children:e.jsx(j,{placeholder:"姓名",disabled:t.model=="get"})}),e.jsx(l.Item,{name:"userName",label:"工号/学号",rules:[{required:!0,message:"不能为空"}],children:e.jsx(j,{placeholder:"工号/学号",disabled:t.model=="get"})}),t.model=="add"&&e.jsx(l.Item,{name:"passWord",label:"密码",rules:[{required:!0,message:"不能为空"}],children:e.jsx(j.Password,{placeholder:"密码"})}),e.jsx(l.Item,{name:"email",label:"email",children:e.jsx(j,{placeholder:"email",disabled:t.model=="get"})}),e.jsx(l.Item,{name:"phone",label:"手机号",children:e.jsx(j,{placeholder:"手机号",disabled:t.model=="get"})}),e.jsx(l.List,{name:"roles",children:(n,d)=>s.createElement(l.Item,{...n[0],key:$(),label:"身份",rules:[{required:!0,message:"不能为空"}]},e.jsx(z,{options:Object.entries(R).map(([,r])=>({label:S.roleMap(r),value:r})),disabled:t.model=="get"}))}),_.includes(R.Student)&&e.jsx(l.Item,{name:["createStudentExt","gradId"],label:"班级",rules:[{required:!0,message:"不能为空"}],children:e.jsx(z,{showSearch:!0,placeholder:"输入搜索班级",onSearch:u,options:x,optionFilterProp:"label",value:F,searchValue:q,onChange:v,disabled:t.model=="get"})})]})})},ee=t=>{const[i,c]=s.useState(!1),[y,g]=s.useState(!1);s.useEffect(()=>{c(t.show),t.show&&S.resetFields()},[t.show]),s.useEffect(()=>{t.showChange(i)},[i]);const w=()=>{c(!1)},m=()=>{S.submit()},[S]=l.useForm(),b=async C=>{try{C.userId=t.putId+"",await I.apiAccountChangePasswordPut(C),c(!1)}catch{}g(!1)};return e.jsx(K,{title:"更新密码",open:i,onOk:m,onCancel:w,confirmLoading:y,children:e.jsxs(l,{layout:"vertical",form:S,onFinish:b,children:[e.jsx(l.Item,{name:"newPassword",label:"新密码",rules:[{required:!0,message:"不能为空"}],children:e.jsx(j.Password,{})}),e.jsx(l.Item,{name:"confirmPassword",label:"再次输入新密码",rules:[{required:!0,message:"不能为空"}],children:e.jsx(j.Password,{})})]})})},Se=()=>{var k;const[t,i]=s.useState([]),[c,y]=s.useState(0),[g,w]=s.useState(1),[m,S]=s.useState(20),[b,C]=s.useState(""),M=G(),[h,p]=s.useState(!1),[U,x]=s.useState(""),[T,F]=s.useState("add"),[O,q]=s.useState(!1);s.useEffect(()=>{N()},[]);const N=async()=>{await u()},u=async(a=g,o=m,f=b)=>{var P,E;const A=await I.apiAccountGet([],a,o,f);i(((P=A.data.data)==null?void 0:P.dataList)||[]),y(((E=A.data.data)==null?void 0:E.total)||0)},v=[{title:"姓名",dataIndex:"name",key:"name"},{title:"工号/学号",dataIndex:"userName",key:"userName"},{title:"身份",key:"roles",render:(a,o)=>o.roles.map(M.roleMap)+""},{title:"邮件",key:"email",dataIndex:"email"},{title:"手机号",dataIndex:"phoneNumber",key:"phoneNumber"},{title:"操作",key:"action",render:(a,o)=>e.jsxs(B,{size:"middle",children:[e.jsx("a",{onClick:()=>d(o.id),children:"查看"}),e.jsx("a",{onClick:()=>n(o.id),children:"修改"}),e.jsx(W,{onClick:()=>r(o.id),danger:!0,children:"重置密码"}),e.jsx(Y,{title:"提示",description:`确定删除用户 ${o.name} ?`,onConfirm:()=>D(o),okText:"确定",cancelText:"取消",children:e.jsx(W,{danger:!0,children:"删除"})})]})}],_=async(a,o)=>{w(a),S(o),await u(a,o)},V=async()=>{F("add"),p(!0)},D=async a=>{await I.apiAccountIdDelete(a.id),await u()},n=async a=>{F("put"),p(!0),x(a)},d=async a=>{F("get"),p(!0),x(a)},r=async a=>{q(!0),x(a)},L=async(a,o,f)=>{(f==null?void 0:f.source)=="input"&&(C(a),w(1),await u(1,void 0,a))};return e.jsxs(B,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(B,{children:[e.jsx(H,{placeholder:"输入查询的姓名/工号/学号",onSearch:L,enterButton:!0}),(k=M.user)!=null&&k.roles.includes("Admin")?e.jsx(W,{type:"primary",onClick:()=>V(),children:"新增"}):e.jsx(e.Fragment,{})]}),e.jsx(X,{columns:v,pagination:{position:["bottomCenter"],total:c,showSizeChanger:!0,current:g,pageSize:m,onChange:_},dataSource:t,rowKey:"id"}),e.jsx(Z,{show:h,showChange:a=>p(a),onFinish:u,model:T,putId:U}),e.jsx(ee,{show:O,showChange:a=>q(a),putId:U})]})};export{Se as default};
