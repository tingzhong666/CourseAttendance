import{r as t,j as e}from"./index-DgfN0RmO.js";import{F as S,I as V,S as $}from"./index-_43Vwt3Q.js";import{M as m,U as v}from"./httpInstance-C_FOBErx.js";import{u as H}from"./auth-CecISokB.js";import{M as J,S as M,F as N,P as Q}from"./Table-SxWRHuAv.js";import{u as W}from"./major-CxZ5Y5SK.js";import{B as b}from"./button-Ds4jMy4a.js";import"./useVariants-PvTSNNAD.js";import"./Compact-dGReMvx5.js";import"./row-Dhi0eNVG.js";import"./addEventListener-DRIwr8ko.js";import"./EllipsisOutlined-BYhQ3a5y.js";import"./Overflow-CC-a_4zy.js";import"./index-DgSE1BWK.js";import"./index-B0Z_OXbc.js";import"./index-DPluUIIC.js";const X=a=>{const[i,d]=t.useState(!1),[x,h]=t.useState(!1),[f,c]=t.useState("");t.useEffect(()=>{d(a.show),a.show&&j()},[a.show]),t.useEffect(()=>{a.showChange(i)},[i]);const j=async()=>{if(a.model=="put"){var n=await m.apiMajorsCategoryIdGet(a.putId||-1);r.setFieldsValue(n.data.data),c("修改专业")}else a.model=="add"?(r.resetFields(),c("新增专业")):a.model=="get"&&c("专业详情")},y=()=>{d(!1)},C=()=>{r.submit()},[r]=S.useForm(),p=async n=>{try{await r.validateFields(),h(!0),a.model=="add"?await m.apiMajorsCategoryPost(n):a.model=="put"&&await m.apiMajorsCategoryPut(a.putId,n),a.onFinish(),d(!1)}catch{}h(!1)};return e.jsx(J,{title:f,open:i,onOk:C,onCancel:y,confirmLoading:x,okText:"确定",cancelText:"取消",children:e.jsx(S,{layout:"vertical",form:r,onFinish:p,children:e.jsx(S.Item,{name:"name",rules:[{required:!0,message:"不能为空"}],label:"大专业名",children:e.jsx(V,{placeholder:"大专业名"})})})})},ft=()=>{var k,T;const a=H(),[i,d]=t.useState([]),[x,h]=t.useState(0),[f,c]=t.useState(1),[j,y]=t.useState(20),[C,r]=t.useState(""),p=W(),[n,g]=t.useState(!1),F=t.useRef(n);t.useEffect(()=>{F.current=n},[n]),t.useEffect(()=>(L(),()=>{F.current&&p.update()}),[]);const L=async()=>{await l()},l=async(s=f,o=j,u=C)=>{var E,P;var A=await m.apiMajorsCategoryGet(s,o,u);d(((E=A.data.data)==null?void 0:E.dataList)||[]),h(((P=A.data.data)==null?void 0:P.total)||0)},O=async s=>{await m.apiMajorsCategoryDelete(s.id),await l(),g(!0)},R=[{title:"名称",dataIndex:"name",key:"name"},{title:"操作",key:"action",render:(s,o)=>e.jsxs(M,{size:"middle",children:[e.jsx("a",{onClick:()=>K(o.id||-1),children:"修改"}),e.jsx(Q,{title:"提示",description:`确定删除大专业 ${o.name} ?`,onConfirm:()=>O(o),okText:"确定",cancelText:"取消",children:e.jsx(b,{danger:!0,children:"删除"})})]})}],B=async(s,o,u)=>{(u==null?void 0:u.source)=="input"&&await l(1,void 0,s)},D=async(s,o)=>{c(s),y(o),await l(s,o)},[_,w]=t.useState(!1),[q,z]=t.useState(-1),[G,I]=t.useState("add"),U=()=>{I("add"),w(!0),g(!0)},K=s=>{I("put"),w(!0),z(s),g(!0)};return e.jsxs(M,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(M,{children:[e.jsx($,{placeholder:"输入查询的大专业名",onSearch:B,enterButton:!0}),(k=a.user)!=null&&k.roles.includes(v.Admin)||(T=a.user)!=null&&T.roles.includes(v.Academic)?e.jsx(b,{type:"primary",onClick:U,children:"新增"}):e.jsx(e.Fragment,{})]}),e.jsx(N,{columns:R,pagination:{position:["bottomCenter"],total:x,showSizeChanger:!0,current:f,pageSize:j,onChange:D},dataSource:i,rowKey:"id"}),e.jsx(X,{show:_,showChange:s=>w(s),onFinish:l,model:G,putId:q})]})};export{ft as default};
